import{initializeApp}from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";import{getMessaging,getToken}from "https://www.gstatic.com/firebasejs/9.15.0/firebase-messaging.js";function setTokenSentToServer(sent){window.localStorage.setItem('ControlPushID',sent);}
function isTokenSentToServer(sent){try{return window.localStorage.getItem('ControlPushID')===sent;}catch(e){return false;}}
const firebaseConfig={apiKey:"AIzaSyCqmyYhcWID4EocYEOLiCK2Rt6Edy3pWAA",authDomain:"plus-webpush.firebaseapp.com",databaseURL:"https://plus-webpush.firebaseio.com",projectId:"plus-webpush",storageBucket:"plus-webpush.appspot.com",messagingSenderId:"258846513296",appId:"1:258846513296:web:16db8c26e03cf8486ea015"};function requestPermission(){Notification.requestPermission().then((permission)=>{if(permission==="granted"){console.log("Notification permission granted.");const app=initializeApp(firebaseConfig);const messaging=getMessaging(app);getToken(messaging,{vapidKey:"BOY1yFuR9bl7pAub6k1fS30EEROR9DHyyXE75Mo9vnkRemwUMfAAUZ08CrG0cca5SekLnvuJvLds8fJSmxsYtf0",}).then((currentToken)=>{if(isTokenSentToServer(currentToken)){console.log("Token already saved.");}else{if(currentToken){console.log("currentToken: ",currentToken);saveToken(currentToken);}else{console.log("Can not get token");}}});}else{console.log("Do not have permission!");}});}
function saveToken(currentToken){var userLang=(navigator.language||navigator.userLanguage)||"none";var http=new XMLHttpRequest();var url='https://controlpush.com/push/kolaytv';var params="token="+currentToken;http.open('POST',url,true);http.setRequestHeader('Content-type','application/x-www-form-urlencoded');http.onreadystatechange=function(){if(http.readyState==4&&(http.status==200||http.status==505)){console.log("Done, notification granted.");setTokenSentToServer(currentToken);}}
http.send(params);}
requestPermission();